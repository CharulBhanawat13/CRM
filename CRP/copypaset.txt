
select norg_id ,count(*)
from tbl_visitplan
where norg_id IN (SELECT norg_id
from tbl_organisation
WHERE norg_group_id=2)
 group by norg_id

--------------------------


CREATE TEMPORARY TABLE tbl_visitCount
select norg_id ,count(*) AS nofVisit
from tbl_visitplan
where norg_id IN (
SELECT norg_id FROM tbl_organisation
WHERE norg_group_id=2)
group by norg_id;



CREATE TEMPORARY TABLE tbl_callListCount
select norg_id ,count(*) AS noOFCallList
from tbl_callList
where norg_id IN (
SELECT norg_id FROM tbl_organisation
WHERE norg_group_id=2)
group by norg_id;


CREATE TEMPORARY TABLE tbl_tourCount
select norg_id ,count(*) AS noOfTour
from tbl_tour
where norg_id IN (
SELECT norg_id FROM tbl_organisation
WHERE norg_group_id=2)
group by norg_id;

select o.norg_id ,o.corg_name ,IFNULL(`nofVisit`,0) AS nofVisit,
IFNULL(`noOFCallList`,0) AS noOFCallList,IFNULL(`noOfTour`,0) AS noOfTour from tbl_organisation AS o
LEFT JOIN tbl_visitCount AS vc
ON vc.norg_id=o.norg_id
LEFT JOIN tbl_callListCount AS CL
ON CL.norg_id=o.norg_id
LEFT JOIN tbl_tourCount AS TC
ON TC.norg_id=o.norg_id
where o.norg_group_id=2;

-----------------------------------------
SELECT     dbo.tbl_ItemSubGroupMaster.nID, dbo.tbl_ItemSubGroupMaster.nitemSubGRoup_UniqueID, dbo.tbl_ItemSubGroupMaster.nAccountMasterID_UniqueID,
                      RIGHT('000000' + CAST(ISNULL(dbo.tbl_AccountMaster.nAccountID, 0) AS VARCHAR(6)), 6) AS nAccountMasterID, ISNULL(dbo.tbl_AccountMaster.cACName, '')
                      AS cACName, dbo.tbl_ItemGroupMaster.nItemSuperGroupID AS nISuperGID, dbo.tbl_ItemSuperGroup.cItemSGroup, dbo.tbl_ItemSubGroupMaster.nIGID_UniqueID,
                      dbo.tbl_ItemGroupMaster.nItemGroupID AS nIGID, dbo.tbl_ItemGroupMaster.cItemGroup, dbo.tbl_ItemSubGroupMaster.nISubGroupID,
                      dbo.tbl_ItemSubGroupMaster.cItemSubGroup, dbo.tbl_ItemSubGroupMaster.cItemSubGroupDesc, dbo.tbl_ItemSubGroupMaster.Is_Active,
                      dbo.tbl_ItemSubGroupMaster.Is_Lock, dbo.tbl_ItemSubGroupMaster.LockedBy_UserID, dbo.tbl_ItemSubGroupMaster.nCompanyID,
                      dbo.tbl_ItemSubGroupMaster.nTarrifUniqueId, dbo.tbl_TariffMaster.cTariffHead, dbo.tbl_ItemSubGroupMaster.cAlternateId
FROM         dbo.tbl_ItemSubGroupMaster INNER JOIN
                      dbo.tbl_ItemGroupMaster ON dbo.tbl_ItemSubGroupMaster.nIGID_UniqueID = dbo.tbl_ItemGroupMaster.nItemGroupUniqueID AND
                      dbo.tbl_ItemGroupMaster.Is_Available = 1 AND dbo.tbl_ItemGroupMaster.Is_Active = 1 INNER JOIN
                      dbo.tbl_ItemSuperGroup ON dbo.tbl_ItemGroupMaster.nItemSuperGroupID = dbo.tbl_ItemSuperGroup.nItemSGroupID AND dbo.tbl_ItemSuperGroup.Is_Active = 1 AND
                      dbo.tbl_ItemSuperGroup.Is_Available = 1 LEFT OUTER JOIN
                      dbo.tbl_TariffMaster ON dbo.tbl_ItemSubGroupMaster.nTarrifUniqueId = dbo.tbl_TariffMaster.nUniqueID LEFT OUTER JOIN
                      dbo.tbl_AccountMaster ON dbo.tbl_ItemSubGroupMaster.nAccountMasterID_UniqueID = dbo.tbl_AccountMaster.nAccount_UniqueID AND
                      dbo.tbl_AccountMaster.Is_Available = 1 AND dbo.tbl_AccountMaster.Is_Active = 1
WHERE     (dbo.tbl_ItemSubGroupMaster.Is_Available = 1)


SELECT nitemSubGRoup_UniqueID , ISNULL(cAlternateId,'') + ' - ' + ISNULL(cItemSubGroup,'')
FROM View_GetItemGroup_SubGroup
Where nID > 0 AND Is_Active = 1 AND nCompanyID = 1 AND cItemSGroup IN ('FINISHED GOODS')
Order by cAlternateId ,cItemSubGroup

TRUNCATE TABLE tbl_organisation
TRUNCATE TABLE tbl_organisation_group
TRUNCATE TABLE tbl_tour
TRUNCATE TABLE tbl_callList
TRUNCATE TABLE tbl_visitplan
TRUNCATE TABLE tbl_contactperson
============================================
16/ 01/ 2021

CREATE TEMPORARY TABLE tbl_facility
Select s.csegment_name,og.corg_group_name,o.corg_name,o.norg_id from tbl_segment AS s
JOIN tbl_organisation_group AS og
ON og.nsegment_id=s.ninternal_id
JOIN tbl_organisation AS o
ON o.norg_group_id=og.ninternal_id
where s.ninternal_id=2;


CREATE TEMPORARY TABLE tbl_visitCount
select norg_id ,count(*) AS nofVisit
from tbl_visitplan;

CREATE TEMPORARY TABLE tbl_callListCount
select norg_id ,count(*) AS noofCallList
from tbl_callList;

CREATE TEMPORARY TABLE tbl_tourCount
select norg_id ,count(*) AS noofTour
from tbl_tour;

select f.csegment_name ,f.corg_group_name ,f.corg_name,IFNULL(`nofVisit`,0) AS nofVisit,IFNULL(`noofCallList`,0) AS noofCallList,IFNULL(`noofTour`,0) AS noofTour
 from tbl_facility AS f
LEFT JOIN tbl_visitCount AS vc
ON vc.norg_id=f.norg_id
LEFT JOIN tbl_callListCount AS cc
ON cc.norg_id=f.norg_id
LEFT JOIN tbl_tourCount AS tc
ON tc.norg_id=f.norg_id;
